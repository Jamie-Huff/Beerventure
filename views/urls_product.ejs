<!doctype html>

<html lang="en">
<head>
  <!-- internal css -->
  <!-- <link rel="stylesheet" href="css/styles.css?v=1.0"> -->
  <link rel="stylesheet" href="/styles/searchPage.css" type="text/css" />
  <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" type="text/css" />
  <link rel="stylesheet" href="/vendor/border-box.css" type="text/css" />
  <link rel="stylesheet" href="/styles/layout.css" type="text/css" />
  <link rel="stylesheet" href="/styles/products.css" type="text/css" />
  <link rel="stylesheet" href="/styles/each_item.css" type="text/css" />
  

  <!-- internal js -->

  <!-- external css -->

  <!-- external js -->



  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>

    $(document).ready(() =>{
      console.log('ready');

      const createItemManagement = function (dataInput) {
        const { user, items } = dataInput;

        console.log('user line 28: ', user);
        console.log('items line 29: ', items);

        const $article = $("<article class=\"item-management-article\">");
        const escape = function (str) {
          let div = document.createElement("div");
          div.appendChild(document.createTextNode(str));
          return div.innerHTML;
        };

        const html = `
          <h4>Item Management</h4>
          <form method="POST" action="/products/item_sale_status/:">
            <label for="featured-check">Make this a featured Item</label>
            <br>
            <input type="checkbox" id="featured_check" name="${item.id}">
            <br>
          </form>
          
          <form method="POST" action="/product/item_sale_status/:${item.id}"> 
            <label class="switch">
              <input type="checkbox">
              <span class="slider round"></span>
            </label>
          </form>
          
          <br>
          
          <form method="POST" action="/product/delete_item/:">
            <button type="submit" name="${item.id}" class="btn danger">Delete This Item</button>
          </form>
          `;
        return $article.html(html);
      };



      const loadItemManagement = function(dataInput) {
        $.ajax(getIt)
          .then(function(dataInput) {
            console.log('dataInput line 73: ', dataInput);


            $('.item-management').css("visibility", "visible");

            $('#item-management').prepend(createItemManagement(dataInput));
          });
      };

      // FOR TESTING - LOAD ITEM MANAGEMENT REGARDLESS OF WHETHER A USER.VENDOR = TRUE
      loadItemManagement();


      // AJAX POST request that sends the form data to the server.
      $("#featured_check").submit(function(event) {
        event.preventDefault();

        const sliderAction = $(event.target);

        console.log('sliderAction line 77:', sliderAction);

        $.post('/products/item_sale_status/', sliderAction);
      });

      // repeat the above function for the checkbox and the delete button



    });

  </script>
</head>

<% if (userObject) { %>
  <%- include('partials/_navbarSignedIn') %>
  <% } else { %>
  <%- include('partials/_navbar') %>
  <% } %>
<h1>Product Information Page</h1>
<body>
  <% if (userObject.vendor) { %>
    <h2>I'm a vendor</h2>
    <section class="item-management" id="item-management">
      <h4>Item Management</h4>
          <form method="POST" action="/products/item_sale_status/:">
            <label for="featured-check">Make this a featured Item</label>
            <br>
            <input type="checkbox" id="featured_check" name="${item.id}">
            <br>
          </form>
          
          <form method="POST" action="/product/item_sale_status/:${item.id}"> 
            <label class="switch">
              <input type="checkbox">
              <span class="slider round"></span>
            </label>
          </form>
          
          <br>
          
          <form method="POST" action="/product/delete_item/:">
            <button type="submit" name="${item.id}" class="btn danger">Delete This Item</button>
          </form>
    </section>

  <% } %>
  
  <main class="all-products">
    <div class="products">


  <% for (const item of items) { %>
    <div class="featured-items">
      <p class="prod-name"> <%= item.vendor %> </p>
      <p class="prod-name"> <%= item.name %> </p>
      <img class="product-image" src=<%= item.image %>
      <p> <%= item.category %> </p>
      <p><%= item.price %> </p>
    </div>
    
    <div class="product-description">
      <p> <%= item.description %> </p>
    </div>





  <% } %>

    </div>





  </main>




    <%- include('partials/_footer'); %>


</body>

</html>
